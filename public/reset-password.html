<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Restablecer contraseña</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <h2>Restablecer contraseña</h2>

    <div>
      <input
        id="password"
        type="password"
        placeholder="Nueva contraseña"
        autocomplete="new-password"
      />
    </div>
    <div style="margin-top: 8px">
      <button id="btn-reset">Cambiar contraseña</button>
    </div>

    <p id="msg" style="margin-top: 12px; color: red;"></p>

    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

      const supabase = createClient(
        "https://axggbupenrrsqjhjhnbg.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4Z2didXBlbnJyc3FqaGpobmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NjQwMDIsImV4cCI6MjA4MjM0MDAwMn0.M7q025ebZiiN7Jcd-5TBKdU60VFVBmkU3Ge6peAuJP4"
      );

      const msgEl = document.getElementById("msg");

      document.getElementById("btn-reset").addEventListener("click", async () => {
        msgEl.style.color = "red";
        msgEl.textContent = "";

        const newPassword = document.getElementById("password").value.trim();
        if (!newPassword) {
          msgEl.textContent = "Introduce una nueva contraseña.";
          return;
        }

        // Supabase v2: NO necesitas token manual
        const { data, error } = await supabase.auth.updateUser({
          password: newPassword
        });

        if (error) {
          msgEl.textContent = "Error: " + error.message;
          return;
        }

        msgEl.style.color = "green";
        msgEl.textContent =
          "Contraseña cambiada correctamente. Ya puedes iniciar sesión.";
      });
    </script>
  </body>
</html>
